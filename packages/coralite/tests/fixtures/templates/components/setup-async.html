<template id="coralite-setup-async">
  <div class="setup-async">
    <p>Message: <span data-coralite-ref="message">{{ message }}</span></p>
    <p>Prop: <span data-coralite-ref="prop">{{ propValue }}</span></p>
    <p>Client: <span data-coralite-ref="client-msg">-</span></p>
  </div>
</template>

<script type="module">
  import { defineComponent } from 'coralite'

  const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms))

  export default defineComponent({
    // New setup function replacing TLA
    async setup(values) {
      await delay(50)
      return {
        message: 'Resolved',
        propValue: values.myProp || 'default',
        serverValue: 'passed-to-client'
      }
    },
    // Client-side script receiving values from setup
    script({ values }, { refs }) {
      const clientMsg = refs('client-msg')
      if (clientMsg) {
        clientMsg.textContent = values.serverValue
      }
    }
  })
</script>